services:
  hotel-api:
    build:
      context: .
      dockerfile: backend/hotel-api/Dockerfile
    image: stayflex/hotel-api:local
    environment:
      - PORT=8080
    ports:
      - "8080:8080"

  guest-web:
    build:
      context: apps/guest-web
    image: stayflex/guest-web:local
    environment:
      - NEXT_PUBLIC_API_BASE=http://host.docker.internal:8080
    extra_hosts:
      - "host.docker.internal:host-gateway"

  admin-web:
    build:
      context: apps/admin-web
    image: stayflex/admin-web:local
    environment:
      - NEXT_PUBLIC_API_BASE=http://host.docker.internal:8080
    extra_hosts:
      - "host.docker.internal:host-gateway"

  web:
    image: nginx:alpine
    depends_on:
      - guest-web
      - admin-web
    volumes:
      - ./nginx.conf:/etc/nginx/nginx.conf:ro
    ports:
      - "3000:80"

  e2e:
    build:
      context: .
      dockerfile: tests/e2e/Dockerfile
    image: stayflex/e2e:local
    depends_on:
      - hotel-api
    environment:
      - BASE_URL=${BASE_URL:-http://host.docker.internal:3000}
    extra_hosts:
      - "host.docker.internal:host-gateway"
    shm_size: 1g
    entrypoint: ["npm", "test"]
